
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Clocked Reads with the Support Package</title><meta name="generator" content="MATLAB 7.13"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2011-08-11"><meta name="DC.source" content="clockedSensorRead.m"><style type="text/css">

body {
  background-color: white;
  margin:10px;
}

h1 {
  color: #990000; 
  font-size: x-large;
}

h2 {
  color: #990000;
  font-size: medium;
}

/* Make the text shrink to fit narrow windows, but not stretch too far in 
wide windows. */ 
p,h1,h2,div.content div {
  max-width: 600px;
  /* Hack for IE6 */
  width: auto !important; width: 600px;
}

pre.codeinput {
  background: #EEEEEE;
  padding: 10px;
}
@media print {
  pre.codeinput {word-wrap:break-word; width:100%;}
} 

span.keyword {color: #0000FF}
span.comment {color: #228B22}
span.string {color: #A020F0}
span.untermstring {color: #B20000}
span.syscmd {color: #B28C00}

pre.codeoutput {
  color: #666666;
  padding: 10px;
}

pre.error {
  color: red;
}

p.footer {
  text-align: right;
  font-size: xx-small;
  font-weight: lighter;
  font-style: italic;
  color: gray;
}

  </style></head><body><div class="content"><h1>Clocked Reads with the Support Package</h1><!--introduction--><p>This example shows how to perform a clocked read of a sensor using the Support Package. Clocked reads collect many samples at once at a specified sample rate.</p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#1">Create a Data Acquisition Toolbox session</a></li><li><a href="#2">Configure session for clocked reads</a></li><li><a href="#3">Add a sensor channel and retrieve the scaling function</a></li><li><a href="#4">Collect a set of data and scale it</a></li><li><a href="#6">Playback</a></li><li><a href="#8">Clean up</a></li></ul></div><h2>Create a Data Acquisition Toolbox session<a name="1"></a></h2><pre class="codeinput">s = sdaq.createSession;
</pre><h2>Configure session for clocked reads<a name="2"></a></h2><p>The session should be configured with a sample rate and duration. Sample rate is determined by the Rate property (currently set to 44.1kHz, the standard sample rate for CD quality audio). Duration is determined by either the NumberOfScans property (the number of samples to acquire) or the DurationInSeconds property (how long to acquire samples). NumberOfScans and DurationInSeconds are interdependant; it's only necessary to change one of them.</p><p>Note that Data Acquisition Toolbox requires that the rate be set before adding any SensorDAQ (and only SensorDAQ) channels to the device. Changing the rate after adding SensorDAQ channels will cause an error. Therefore, always configure sessions for clocked aquisition <i>before</i> adding SensorDAQ channels.</p><pre class="codeinput">s.Rate = 44100;
s.NumberOfScans = 3000;
</pre><h2>Add a sensor channel and retrieve the scaling function<a name="3"></a></h2><pre class="codeinput">sdaq.addSensor(s,1,sdaq.Sensors.Microphone);
scale = sdaq.getScaleFun(sdaq.Sensors.Microphone);
</pre><h2>Collect a set of data and scale it<a name="4"></a></h2><p>These lines are essentially identical to the corresponding lines for unclocked input; the only difference is that s.inputSingleScan has been replaced by s.startForeground. startForeground tells the session to collect a vector of data according to the session's properties.</p><p>Also, note that the scaling functions returned by getScaleFun can scale vectors and matricies as well as scalar values.</p><pre class="codeinput">data = scale(s.startForeground);
plot(data);
</pre><img vspace="5" hspace="5" src="clockedSensorRead_01.png" alt=""> <p>Note that we could have used s.startBackground instead. s.startBackground allows MATLAB to process other commands while the session is collecting data. This is helpful for continuously reading data from a device and processing it on the fly. See the documentation for daq.Session.startBackground for more information.</p><h2>Playback<a name="6"></a></h2><p>data contains about 68ms of sound data. We can play back this sound data using wavplay:</p><pre class="codeinput">wavplay(data,s.Rate);
</pre><p>With so short a sample set (chosen for the legibility of the plot), the sound is pretty unremarkable. However, it's possible to collect data for much longer and produce uncompressed CD quality audio using SensorDAQ and a microphone sensor.</p><h2>Clean up<a name="8"></a></h2><pre class="codeinput">delete(s);
</pre><pre> MATLAB Support Package for Vernier SensorDAQ
 Version 1.0</pre><p class="footer">Copyright 2011 The MathWorks, Inc.<br>
      Published with MATLAB&reg; 7.13<br></p></div><!--
##### SOURCE BEGIN #####
%% Clocked Reads with the Support Package
% This example shows how to perform a clocked read of a sensor using the
% Support Package. Clocked reads collect many samples at once at a
% specified sample rate.

%% Create a Data Acquisition Toolbox session
s = sdaq.createSession;

%% Configure session for clocked reads
% The session should be configured with a sample rate and duration. Sample
% rate is determined by the Rate property (currently set to 44.1kHz, the
% standard sample rate for CD quality audio). Duration is determined by
% either the NumberOfScans property (the number of samples to acquire) or
% the DurationInSeconds property (how long to acquire samples).
% NumberOfScans and DurationInSeconds are interdependant; it's only
% necessary to change one of them.
%
% Note that Data Acquisition Toolbox requires that the rate be set before
% adding any SensorDAQ (and only SensorDAQ) channels to the device.
% Changing the rate after adding SensorDAQ channels will cause an error.
% Therefore, always configure sessions for clocked aquisition _before_
% adding SensorDAQ channels.
s.Rate = 44100;
s.NumberOfScans = 3000;

%% Add a sensor channel and retrieve the scaling function
sdaq.addSensor(s,1,sdaq.Sensors.Microphone);
scale = sdaq.getScaleFun(sdaq.Sensors.Microphone);

%% Collect a set of data and scale it
% These lines are essentially identical to the corresponding lines for
% unclocked input; the only difference is that s.inputSingleScan has been
% replaced by s.startForeground. startForeground tells the session to
% collect a vector of data according to the session's properties. 
%
% Also, note that the scaling functions returned by getScaleFun can scale
% vectors and matricies as well as scalar values.
data = scale(s.startForeground);
plot(data);
%%
% Note that we could have used s.startBackground instead. s.startBackground
% allows MATLAB to process other commands while the session is collecting
% data. This is helpful for continuously reading data from a device and
% processing it on the fly. See the documentation for
% daq.Session.startBackground for more information.

%% Playback
% data contains about 68ms of sound data. We can play back this sound
% data using wavplay:
wavplay(data,s.Rate);
%%
% With so short a sample set (chosen for the legibility of the plot), the
% sound is pretty unremarkable. However, it's possible to collect data for
% much longer and produce uncompressed CD quality audio using SensorDAQ and
% a microphone sensor.

%% Clean up
delete(s);
%%
%
%
%   MATLAB Support Package for Vernier SensorDAQ
%   Version 1.0
%   Copyright 2011 The MathWorks, Inc.
##### SOURCE END #####
--></body></html>